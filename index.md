# AbanPrime API Documentation

## Overview
The Futures API allows authenticated users to manage their futures trading positions, predict potential debts, manage orders, and retrieve market information. All non-admin operations are covered in this documentation.

## Authentication & Example Request
 
The authentication method is based on an **HMAC-SHA256 signature** with your API key and secret.

---

## 1. Authentication Overview

Every request to the API must include:

- **API-KEY** – your public API key.
- **API-SIGN** – a Base64-encoded HMAC-SHA256 signature of the request.
- **TIMESTAMP** – the current UTC timestamp in milliseconds since the Unix epoch.

### How the signature (`API-SIGN`) is created

1. Build a string to sign:
{request_path}{http_method}{api_key}{timestamp}

Example:

/user/userGETmyApiKeyHere1735961812345

2. Hash the string with **HMAC-SHA256** using your **Secret Key**.  
3. Base64-encode the result → this is the `API-SIGN`.  

**Note: Do not include query string in {request_path}**

## 2. Required Headers

Every request must include:

| Header      | Description |
|-------------|-------------|
| `API-KEY`   | Your API key |
| `API-SIGN`  | Generated HMAC signature |
| `TIMESTAMP` | Current UTC timestamp in milliseconds |

---

## 3. Example Request & Response

**Request:**

GET https://api.abanprime.com/user/user

**Headers:**
API-KEY: your-api-key
API-SIGN: generated-signature
TIMESTAMP: 1735961812345


**Response (example):**

```json
{
  "id": 12345,
  "email": "user@example.com",
  "status": "active"
}
```
## `Time Endpoint`

This controller provides endpoints related to server time that can be used for api signing.

### 1. Get Server Time

This endpoint returns the current server timestamp.

*   **Endpoint:** `GET /api/Time`
*   **Successful Response (`200 OK`):**
    ```json
    1678886400000 // Example: A long integer representing the server timestamp (e.g., Unix timestamp in milliseconds).
    ```


## Base URL
All API URLs listed in this documentation are relative to the following base URL: https://api.abanprime.com

---

## Orders

### `Order.OrderDto` Definition
The `Order.OrderDto` is a data transfer object used for creating and simulating orders. It contains the following properties:

*   `baseAssetSymbol` (string, required): The symbol of the base asset for the trading pair (e.g., "BTC").
*   `quoteAssetSymbol` (string, required): The symbol of the quote asset for the trading pair (e.g., "USDT").
*   `side` (enum: `Buy`, `Sell`, required): The direction of the order.
*   `type` (enum: `Limit`, `Market`, required): The type of order to place.
    *   `Market`: An order to buy or sell immediately at the current market price.
    *   `Limit`: An order to buy or sell at a specified price or better.
*   `quantity` (decimal, optional): The amount of the `baseAssetSymbol` to trade. Required for `Market` orders. Cannot be set with `quote`.
*   `quote` (decimal, optional): The amount of the `quoteAssetSymbol` to trade. Required for `Market` orders. Cannot be set with `quantity`.
*   `price` (decimal, optional): The price at which to execute the order. Required for `Limit` orders.
*   `marketType` (enum: `P2P`, `OTC`, `Manual`, optional, default: `P2P`): The type of market where the order will be placed.
*   `track` (GUID, optional): A unique identifier to track the order. (Typically generated by the client if needed for tracking).

**Note on `quantity` and `quote`:** For market orders, you must specify either the `quantity` (amount of base asset) or the `quote` (amount of quote asset), but not both. For limit orders, `quantity` is typically used.

---

### 1. Create Order
`POST cross-margin/order`

**Purpose:** Allows the authenticated user to create a new order (Market or Limit) which will be associated with their cross margin account.

**Request Body (`application/json`):**
A JSON object (`Order.OrderDto`) containing the order details.

**Example Request Body (Market Order - Buy BTC with 100 USDT):**

```{ "baseAssetSymbol": "BTC", "quoteAssetSymbol": "USDT", "side": "Buy", "type": "Market", "quote": 100, "marketType": "P2P" }```

**Response:**
Returns the complete `Order` object that was created, including its current state and other relevant details.

### 2. Simulate Order
Simulates an order without actually placing it.

`POST cross-margin/order/simulate`

**Purpose:** Allows user to simulate an order to understand its potential outcome and effects on their cross margin account (e.g., estimated filled quantity, price, fees) before actual execution.

**Request Body (`application/json`):**
A JSON object (`Order.OrderDto`) containing the order details for simulation. The structure is the same as for `Create Order`.

**Example Request Body (Simulate Buy BTC with 100 USDT at market):**

```{ "baseAssetSymbol": "BTC", "quoteAssetSymbol": "USDT", "side": "Buy", "type": "Market", "quote": 100, "marketType": "P2P" }```


**Response:**
Returns the simulated `Order` object with updated information (e.g., estimated fill price, estimated filled quantity, estimated fees). This order will not be persisted.

### 3. Get Order by ID
Retrieves the details of a specific order by its integer ID.

`GET cross-margin/order/{orderId:int}`

**Purpose:** Allows user to fetch the full details of a specific order they own.

**URL Parameters:**
*   `orderId` (integer, required): The unique integer identifier of the order.

**Response:**
Returns the complete `Order` object.

### 4. Get Order by Track
Retrieves the details of a specific order by its GUID (track ID).

`GET cross-margin/order/{orderTrack:guid}`

**Purpose:** Allows the authenticated user to fetch the full details of a specific order they own using its globally unique identifier.

**URL Parameters:**
*   `orderTrack` (GUID, required): The unique GUID that tracks the order.

**Response:**
Returns the complete `Order` object if the authenticated user is the owner of the order.

### 5. Cancel Limit Order by ID
Cancels an open limit order by its integer ID.

`DELETE cross-margin/order/{orderId:int}`

**Purpose:** Allows user to cancel an existing limit order they own before it is filled or partially filled. Only limit orders can be canceled this way.

**URL Parameters:**
*   `orderId` (integer, required): The unique integer identifier of the limit order to cancel.

**Response:**
Returns the updated `Order` object, reflecting its "Cancelled" status, if the cancellation was successful.

### 6. Cancel Limit Order by Track
Cancels an open limit order by its GUID (track ID).

`DELETE cross-margin/order/{orderTrack:guid}`

**Purpose:** Allows user to cancel an existing limit order they own before it is filled or partially filled, using its track Id. Only limit orders can be canceled this way.

**URL Parameters:**
*   `orderTrack` (GUID, required): The unique GUID of the limit order to cancel.

**Response:**
Returns the updated `Order` object, reflecting its "Cancelled" status, if the cancellation was successful.

### 7. List Orders
Retrieves a paginated list of orders for the authenticated user, with filtering options.

`GET cross-margin/orders`

**Purpose:** Provides a way for user to view all their active and historical orders, with optional filtering and pagination.

**Query Parameters:**
*   `pagination.page` (integer, optional, default: 0): The page number to retrieve (0-indexed).
*   `pagination.pageSize` (integer, optional, default: 20): The number of items per page.
*   `filter.type` (enum: `Limit`, `Market`, optional): Filters orders by their type.
*   `filter.state` (enum: `New`, `PartiallyFilled`, `Filled`, `Cancelled`, `Rejected`, optional): Filters orders by their current state.
*   `filter.side` (enum: `Buy`, `Sell`, optional): Filters orders by their side.
*   `filter.marketType` (enum: `P2P`, `OTC`, `Manual`, optional): Filters orders by the market type.
*   `filter.baseAssetSymbol` (string, optional): Filters orders by the base asset symbol (e.g., "BTC").
*   `filter.quoteAssetSymbol` (string, optional): Filters orders by the quote asset symbol (e.g., "USDT").
*   `filter.createdAtGte` (datetime, optional): Filters orders created on or after this timestamp (ISO 8601 format).
*   `filter.createdAtLte` (datetime, optional): Filters orders created on or before this timestamp (ISO 8601 format).

**Response:**
Returns an object containing a list of `Order` objects belonging to the authenticated user and pagination metadata.


#### 8. Change Order Price

*   **Endpoint:** `PUT /futures/order/{orderId:int}`
*   **Description:** Changes the price of an existing limit order.
*   **Parameters:**
    *   `orderId` (route, `int`): The ID of the limit order to modify.
    *   `changePriceDto` (body, `LimitOrder.ChangePriceDto`): Data transfer object containing the new price.
*   **Authentication:** Requires authentication.
*   **Responses:**
    *   `200 OK`: Returns the updated order object.
    *   `404 Not Found`: If the `orderId` does not correspond to an existing order.

---



## Market Data

### 1. Get Market Information
Retrieves detailed information about a specific trading market.

`GET /market/{baseSymbol}-{quoteSymbol}`

**Purpose:** Provides details about a specific trading pair, including its type (P2P, OTC, etc.). This endpoint is publicly accessible without authentication.

**URL Parameters:**
*   `baseSymbol` (string, required): The symbol of the base asset (e.g., "BTC").
*   `quoteSymbol` (string, required): The symbol of the quote asset (e.g., "USDT").

**Response:**
Returns the `Market` object, which contains information like current prices, trading rules, and potentially order book details for OTC markets.

---


## Market Positions

### 1. Get Market Position
Retrieves the market position for the authenticated user in a specific market.

`GET /market-position/{baseSymbol}-{quoteSymbol}`

**Purpose:** Allows the authenticated user to view their market position (e.g., open quantity, PNL, average entry price) for a given trading pair within their cross margin account.

**URL Parameters:**
*   `baseSymbol` (string, required): The symbol of the base asset (e.g., "BTC").
*   `quoteSymbol` (string, required): The symbol of the quote asset (e.g., "USDT").

**Response:**
Returns the `MarketPosition` object for user in the specified market. This object typically includes details like current exposure, Taker fee, Maker fee, realized and unrealized profit/loss, and other position-related metrics.

---


## Market Data


#### 1. Get Market Information

*   **Endpoint:** `GET /futures/market/{baseSymbol}-{quoteSymbol}`
*   **Description:** Retrieves market information for a given base and quote asset pair.
*   **Parameters:**
    *   `baseSymbol` (route, `string`): The symbol of the base asset (e.g., "BTC").
    *   `quoteSymbol` (route, `string`): The symbol of the quote asset (e.g., "USD").
*   **Authentication:** Anonymous access allowed (`AllowAnonymous`).
*   **Responses:**
    *   `200 OK`: Returns the market object.
    *   `404 Not Found`: If the market for the specified symbols and type does not exist.

---


#### 2. List Markets (General)

*   **Endpoint:** `GET /futures/markets`
*   **Description:** Retrieves a paginated, filterable, and searchable list of markets. If authenticated, filters by user; otherwise, retrieves public markets.
*   **Parameters:**
    *   `page` (query): Page number.
    *   `pageSize` (query): Page size. 
*   **Responses:**
    *   `200 OK`: Returns a paginated list of market objects.

---


## `Bank Withdraw` API Documentation 


### 1. List Bank Withdraw Requests

This endpoint allows a user to retrieve a paginated and filtered list of their bank withdrawal requests.

*   **Endpoint:** `GET /bank-withdraw/bank-withdraw-requests`
*   **Description:** Returns a list of bank withdrawal requests for the authenticated user, supporting pagination, filtering, and sorting.
*   **Query Parameters:**
    *   **`pagination` parameters (from `BankWithdrawRequest.EntityPagination`):**
        *   `pagination.page` (integer, optional): The page number to retrieve. Default is 1.
        *   `pagination.pageSize` (integer, optional): The number of items per page. Default is 10.
    *   **`filter` parameters (from `BankWithdrawRequest.BankWithdrawRequestFilter`):**
        *   `filter.startDate` (string, optional): Start date for filtering requests (ISO 8601 format, e.g., `2024-01-01T00:00:00Z`).
        *   `filter.endDate` (string, optional): End date for filtering requests (ISO 8601 format, e.g., `2025-01-01T00:00:00Z`).
        *   `filter.state` (string, optional): Filters by the state of the bank withdraw request (e.g., `New`, `Processing`, `Completed`, `Cancelled`).
        *   `filter.userTimeZone` (string, optional): The user's time zone (e.g., "America/New_York") to correctly interpret date/time filters.
        *   `filter.userId` (integer, automatically set by the API): The `userId` is automatically populated with the authenticated user's ID. Any provided `userId` in the query will be ignored.
        *   *Other relevant filter properties from `TransferRequest.TransferRequestFilter`.*
*   **Successful Response (`200 OK`):**
    ```json
    {
      "items": [
        {
          "id": 101,
          "userId": 456,
          "transferType": "BankWithdraw",
          "transferRequestState": "New",
          "amount": 500.00,
          "asset": {
            "id": 1,
            "symbol": "USD",
            "name": "United States Dollar"
          },
          "destinationAccount": {
            "id": 789,
            "iban": "IRXXXXXXXXXXXXXXXXXXXXXX",
            "ownerFullName": "User Full Name",
            "bankName": "Sample Bank"
          },
          "createdAt": "2025-09-05T15:30:00Z",
          "memo": "Withdrawal for personal use"
          // ... other fields of BankWithdrawRequest
        },
        {
          "id": 102,
          "userId": 456,
          "transferType": "BankWithdraw",
          "transferRequestState": "Completed",
          "amount": 200.00,
          "asset": {
            "id": 1,
            "symbol": "USD",
            "name": "United States Dollar"
          },
          "destinationAccount": {
            "id": 789,
            "iban": "IRXXXXXXXXXXXXXXXXXXXXXX",
            "ownerFullName": "User Full Name",
            "bankName": "Sample Bank"
          },
          "createdAt": "2025-09-04T10:00:00Z",
          "memo": null
          // ... other fields
        }
      ],
      "pagination": {
        "page": 1,
        "pageSize": 10,
        "totalItems": 2,
        "totalPages": 1
      }
    }
    ```

### 2. Create Bank Withdraw Request

This endpoint allows a user to initiate a new bank withdrawal request.

*   **Endpoint:** `POST /bank-withdraw/bank-withdraw-request`
*   **Description:** Creates a new bank withdrawal request for the authenticated user.
*   **Request Body (`application/json`):**
    ```json
    {
      "assetSymbol": "IRT",       // Required: Symbol of the asset to withdraw (e.g., "USD", "EUR").
      "iban": "IRXXXXXXXXXXXXXXXXXXXXXX", // Required: The IBAN of the destination bank account.
      "amount": 500.00,           // Required: The amount to withdraw. Must be greater than 0.
      "paymentId": "OptionalPaymentId", // Optional: A reference or payment ID.
      "note": "Optional note about the withdrawal", // Optional: A note for the request.
      "trackId": "GUID_STRING" // Optional: A unique ID for tracking the request. If not provided, a new one will be generated.
      // "otpCode": "123456", // Required: One-Time Password if 2FA is enabled for the user.
    }
    ```
    *   **Note:**
        *   The `Fee` is calculated automatically by the system and any provided `fee` in the request body will be ignored.
        *   If Two-Factor Authentication (2FA) is enabled for the user, an `otpCode` will be required in the request body.
*   **Successful Response (`200 OK`):**
    ```json
    {
      "id": 103,
      "userId": 456,
      "transferType": "BankWithdraw",
      "transferRequestState": "New", // Initial state of the request
      "amount": 500.00,
      "asset": {
        "id": 1,
        "symbol": "USD"
      },
      "destinationAccount": {
        "id": 789,
        "iban": "IRXXXXXXXXXXXXXXXXXXXXXX",
        "ownerFullName": "User Full Name",
        "bankName": "Sample Bank"
      },
      "createdAt": "2025-09-06T11:00:00Z",
      "memo": "OptionalPaymentId",
      "fee": 5.00, // Calculated fee
      "newClientOrderId": "GUID_STRING", // TrackId
      "info": { "Note": "Optional note about the withdrawal" } // If note was provided
      // ... other fields of the created BankWithdrawRequest
    }
    ```
*   **Error Responses:**
    *   `400 Bad Request`: If `amount` is 0, or if required fields are missing, or if IBAN is invalid.
    *   `401 Unauthorized`: If the user is not authenticated or 2FA is required but `otpCode` is missing/invalid.

### 3. Preview Bank Withdraw Request

This endpoint allows a user to preview the details of a bank withdrawal request without actually creating it. This can be used to see calculated fees or other system-generated details.

*   **Endpoint:** `POST /bank-withdraw/bank-withdraw-request/preview`
*   **Description:** Provides a preview of a bank withdrawal request based on the provided details, including estimated fees. The request is not persisted.
*   **Request Body (`application/json`):**
    ```json
    {
      "assetSymbol": "USD",
      "iban": "IRXXXXXXXXXXXXXXXXXXXXXX",
      "amount": 500.00,
      "paymentId": "OptionalPaymentId",
      "note": "Optional note about the withdrawal"
    }
    ```
*   **Successful Response (`200 OK`):**
    ```json
    {
      "userId": 456,
      "transferType": "BankWithdraw",
      "transferRequestState": "New", // This is a preview, so state is "New"
      "amount": 500.00,
      "asset": {
        "id": 1,
        "symbol": "USD"
      },
      "destinationAccount": {
        "id": 789,
        "iban": "IRXXXXXXXXXXXXXXXXXXXXXX",
        "ownerFullName": "User Full Name",
        "bankName": "Sample Bank"
      },
      "memo": "OptionalPaymentId",
      "fee": 5.00, // Estimated fee
      "newClientOrderId": "GUID_STRING", // A generated trackId for the preview
      "info": { "Note": "Optional note about the withdrawal" }
      // ... other fields of the previewed BankWithdrawRequest
    }
    ```

### 4. Get Single Bank Withdraw Request

This endpoint allows a user to retrieve the details of a specific bank withdrawal request by its ID.

*   **Endpoint:** `GET /bank-withdraw/bank-withdraw-request/{requestId:int}`
*   **Description:** Retrieves the full details of a specific bank withdrawal request. Users can only access their own requests unless they have admin privileges.
*   **Path Parameters:**
    *   `requestId` (integer, required): The unique identifier of the bank withdrawal request.
*   **Successful Response (`200 OK`):**
    ```json
    {
      "id": 101,
      "userId": 456,
      "transferType": "BankWithdraw",
      "transferRequestState": "Completed",
      "amount": 500.00,
      "asset": {
        "id": 1,
        "symbol": "USD",
        "name": "United States Dollar"
      },
      "destinationAccount": {
        "id": 789,
        "iban": "IRXXXXXXXXXXXXXXXXXXXXXX",
        "ownerFullName": "User Full Name",
        "bankName": "Sample Bank"
      },
      "createdAt": "2025-09-05T15:30:00Z",
      "memo": "Withdrawal for personal use",
      "fee": 5.00,
      "newClientOrderId": "some-guid-string",
      "info": null
      // ... full details of the BankWithdrawRequest
    }
    ```
*   **Error Responses:**
    *   `400 Bad Request`: If the requested bank withdrawal request does not belong to the authenticated user (and the user is not an admin).
    *   `404 Not Found`: If no bank withdrawal request with the given `requestId` exists.
